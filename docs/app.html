<!DOCTYPE html>  <html> <head>   <title>app.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               app.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Create server and export <code>app</code> as a module for other modules to require as a dependency 
early in this file</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">express = </span><span class="nx">require</span> <span class="s2">&quot;express&quot;</span>
<span class="nv">app = module.exports = </span><span class="nx">express</span><span class="p">.</span><span class="nx">createServer</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Module requires</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">conf = </span><span class="nx">require</span> <span class="s1">&#39;./lib/conf&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>App configurations</h2>

<h3>Global app settings</h3>

<p><strong>Note</strong>: Notice that we got our session secret from the configuration file. In this file
we can define our configurations as globals or based on the node environment, thus 
keeping all the configurable variables centralized instead of being scattered all over.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">configure</span> <span class="o">-&gt;</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">set</span> <span class="s2">&quot;views&quot;</span><span class="p">,</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="nx">conf</span><span class="p">.</span><span class="nx">dir</span><span class="p">.</span><span class="nx">views</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">set</span> <span class="s2">&quot;view engine&quot;</span><span class="p">,</span> <span class="s2">&quot;jade&quot;</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span> <span class="nx">express</span><span class="p">.</span><span class="nx">bodyParser</span><span class="p">()</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span> <span class="nx">express</span><span class="p">.</span><span class="nx">methodOverride</span><span class="p">()</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span> <span class="nx">express</span><span class="p">.</span><span class="nx">cookieParser</span><span class="p">()</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span> <span class="nx">express</span><span class="p">.</span><span class="nx">session</span>
    <span class="nv">secret: </span><span class="nx">conf</span><span class="p">.</span><span class="nx">sessionSecret</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span> <span class="nx">express</span><span class="p">.</span><span class="nx">static</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="nx">conf</span><span class="p">.</span><span class="nx">dir</span><span class="p">.</span><span class="nx">public</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h3>Environment based settings</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p><strong>Note</strong>: Express defaults to 'development' environment if $NODE_ENV is not defined.
If you wish to change to any other environment, run <code>export NODE_ENV='myEnv'</code>.
You can define as many environments and configurations as you wish.</p>

<p>To get the current node environment, in Express use <code>app.settings.env</code>. </p>

<p>For example, </p>

<pre><code>console.log(app.settings.env)
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">configure</span> <span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span> <span class="nx">express</span><span class="p">.</span><span class="nx">errorHandler</span><span class="p">(</span>
    <span class="nv">dumpExceptions: </span><span class="kc">true</span>
    <span class="nv">showStack: </span><span class="kc">true</span>
  <span class="p">)</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">configure</span> <span class="s2">&quot;production&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span> <span class="nx">express</span><span class="p">.</span><span class="nx">errorHandler</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h3>Require routes</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p><strong>Note</strong>: Routes are placed in a seperate file to reduce the clutter of the main <code>app.js</code> file,
<code>app.js</code> should be used for basic app configurations</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./lib/routes&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h3>Start server</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span> <span class="mi">3000</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s2">&quot;Express server listening on port %d in %s mode&quot;</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">address</span><span class="p">().</span><span class="nx">port</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">env</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 